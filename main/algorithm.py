# In this file there will be the main algorithm
import collections
import operator
import os
import time
import networkx as nx
import numpy as np
import scipy.io
import pandas as pd
from sklearn.decomposition import PCA
import matplotlib.pyplot as plt
from karateclub import DeepWalk
from karateclub import node_embedding as ne
import math
import statistics
import argparse
import logging

logger = logging.getLogger(__name__)

adjnoun_top = list([18, 3, 52, 44, 105, 25, 51, 28, 10, 26])
lesmis_top = list([12, 49, 56, 59, 26, 28, 65, 76, 63, 66])
polbooks_top = list([9, 85, 73, 31, 13, 4, 74, 67, 12, 75])
dolphins_top = list([15, 46, 38, 34, 30, 41, 19, 21, 39, 51])
power_top = list([2555, 2554, 2576, 2562, 4346, 4396, 4337, 4333, 4402, 4382])
PPI_top = list([814, 589, 813, 3545, 287, 3601, 1031, 3334, 1017, 1221, 1959, 1207, 2725, 2925, 3133, 1431, 2587, 713, 1177, 867, 2302, 1114, 2776, 2467, 3758, 1731, 3291, 2807, 2424, 1545, 1509, 1457, 1243, 639, 719, 3587, 735, 1543, 904, 293, 2870, 3016, 3785, 2564, 571, 1508, 2147, 1417, 3468, 1311, 48, 3511, 3425, 2125, 3014, 1462, 1422, 977, 2773, 2761, 1237, 1562, 2317, 378, 46, 2778, 1238, 3306, 1296, 298, 1235, 533, 2151, 1245, 2536, 361, 318, 22, 3413, 2333, 841, 2273, 651, 1793, 829, 3583, 2633, 2554, 2187, 131, 1383, 3563, 2203, 1097, 3012, 2522, 2661, 2357, 558, 2263, 2243, 3581, 1600, 2240, 944, 3305, 1316, 1663, 134, 409, 3464, 1066, 2063, 3656, 3379, 141, 1461, 3568, 2277, 3612, 2481, 1575, 706, 1920, 3770, 3033, 2625, 1599, 3178, 667, 3529, 399, 896, 3208, 1391, 561, 15, 3690, 1110, 606, 3555, 1005, 1507, 118, 1533, 2443, 1071, 227, 1491, 3298, 1914, 2211, 1587, 1247, 882, 1046, 535, 2472, 1636, 1045, 868, 438, 3500, 3176, 2468, 2311, 2976, 13, 2812, 1890, 1517, 660, 2863, 3556, 387, 590, 432, 240, 335, 2762, 2154, 3270, 1530, 481, 1410, 1070, 477, 441, 3213, 3693, 997, 1621, 1330, 121, 2321, 3385, 1023, 3807, 3534, 178, 2672, 2237, 3751, 670, 2442, 595, 3207, 291, 602, 104, 3610, 2139, 2136, 1250, 2706, 1551, 3851, 2811, 2766, 3231, 982, 1350, 1329, 3102, 2471, 3363, 1586, 766, 2816, 3634, 3705, 2992, 1548, 1848, 1012, 1830, 466, 2396, 1817, 823, 644, 3153, 1733, 1326, 278, 1063, 140, 3054, 2635, 2604, 1603, 317, 1076, 2738, 270, 2185, 1809, 3808, 3131, 55, 3019, 2019, 143, 3837, 2158, 1133, 851, 3008, 582, 3452, 2846, 2637, 2128, 1236, 1096, 2703, 1825, 1242, 3387, 385, 866, 731, 2411, 3418, 144, 1065, 1016, 2475, 2363, 1200, 1655, 1211, 1963, 1819, 693, 1093, 2864, 1885, 2854, 271, 1013, 2702, 3220, 1552, 835, 1789, 3559, 3299, 2624, 274, 2887, 2504, 1429, 3651, 3172, 2167, 3662, 730, 2682, 2179, 1240, 2801, 1241, 3092, 2209, 1402, 603, 1227, 826, 3301, 1067, 3843, 579, 126, 2403, 1822, 1438, 3433, 2662, 1547, 431, 3692, 1611, 1091, 1059, 2611, 210, 1239, 856, 549, 2517, 319, 3173, 3825, 1683, 1467, 3672, 3188, 2792, 2107, 2079, 1893, 717, 3804, 1130, 369, 626, 3069, 815, 44, 3794, 2291, 1836, 312, 1019, 3198, 1069, 2309, 1727, 3409, 2789, 1230, 954, 629, 2537, 1831, 517, 299, 3125, 2921, 1589, 1201, 1092, 2600, 1724, 540, 1941, 1, 2072, 2253, 1979, 236, 3731, 2501, 739, 908, 3838, 2407, 1937, 903, 625, 125, 636, 3707, 3567, 3020, 3733, 3582, 246, 198, 320, 721, 3302, 2078, 1946, 1634, 1105, 3079, 1996, 1293, 3847, 676, 605, 3470, 1281, 1220, 203, 191, 3354, 786, 500, 421, 3373, 3370, 2575, 1205, 1058, 244, 204, 3494, 3088, 830, 570, 3708, 2379, 1264, 675, 3368, 1618, 1534, 2524, 1328, 3605, 2462, 1834, 1500, 60, 3495, 3224, 1687, 2429, 3021, 642, 233, 192, 2799, 1947, 1182, 202, 3314, 2132, 1477, 1365, 2361, 1382, 2168, 1370, 707, 1930, 3149, 2916, 1094, 157, 2979, 3300, 2258, 504, 2632, 2631, 1449, 3236, 2601, 2372, 2230, 2998, 2936, 2754, 749, 167, 1840, 1337, 163, 3501, 2313, 1886, 1863, 1167, 47, 2645, 2181, 1248, 758, 3238, 3136, 577, 1743, 1095, 627, 254, 2705, 2109, 1043, 3289, 416, 3117, 2493, 3565, 2033, 3646, 1671, 655, 3777, 2897, 2802, 2482, 2404, 2214, 273, 3736, 824, 3781, 2654, 2437, 1444, 1398, 275, 1333, 695, 2967, 940, 375, 181, 3611, 2141, 1124, 1246, 433, 3496, 1347, 906, 2840, 562, 3566, 3408, 2541, 1132, 1816, 3401, 3161, 3737, 3553, 2988, 2298, 3399, 1346, 734, 350, 2508, 2466, 2283, 1653, 3691, 3251, 2445, 3432, 3076, 2873, 1489, 797, 4, 3653, 3647, 779, 573, 521, 2463, 2064, 1922, 1759, 964, 524, 1737, 342, 3170, 365, 3684, 2881, 2269, 2459, 754, 635, 3430, 2731, 909, 3281, 1741, 724, 3492, 3483, 3089, 2315, 2199, 1394, 428, 3722, 3554, 1938, 1927, 1785, 1765, 228, 2221, 883, 1413, 808, 3179, 3025, 1362, 1129, 263, 1873, 1299, 183, 3655, 3378, 1732, 1021, 1372, 54, 3209, 2973, 596, 1772, 1327, 748, 2500, 1131, 3619, 3229, 948, 759, 2910, 2075, 2049, 1157, 3211, 2183, 1771, 1318, 853, 740, 471, 1797, 2834, 2217, 1594, 1224, 918, 697, 1899, 1709, 979, 3416, 3062, 2768, 2210, 3560, 2934, 2788, 1805, 3740, 3652, 2991, 2558, 1627, 939, 337, 3226, 3061, 3057, 678, 19, 3682, 3482, 3405, 3047, 2614, 2503, 2279, 2159, 1815, 1504, 414, 313, 3137, 2880, 2839, 2717, 1851, 887, 12, 3085, 2970, 3346, 1173, 3249, 2819, 2793, 2656, 1428, 722, 3713, 3539, 2469, 1989, 1951, 1866, 963, 2441, 2004, 1060, 1003, 3809, 3317, 2899, 3023, 3002, 2228, 1609, 1494, 3734, 1736, 1389, 447, 3813, 2035, 1940, 3124, 2848, 2775, 1864, 3623, 2092, 1193, 547, 302, 3792, 3739, 3009, 2244, 3438, 2295, 1780, 2586, 2427, 2406, 2362, 3123, 2980, 1616, 3485, 2066, 1573, 286, 2577, 2166, 2098, 647, 90, 3044, 2995, 1901, 1577, 1395, 1344, 3806, 2275, 2137, 1134, 548, 2233, 1967, 1529, 1433, 1339, 2370, 1839, 1644, 472, 3669, 1356, 765, 285, 49, 2574, 1479, 1266, 1081, 64, 3497, 3077, 799, 216, 2962, 2160, 981, 3752, 3488, 2397, 1931, 1511, 1282, 1223, 897, 3441, 2557, 2545, 2245, 1267, 498, 2330, 2272, 1778, 718, 27, 3361, 2579, 2365, 2268, 708, 136, 2419, 2398, 419, 3038, 2584, 2552, 1837, 1550, 917, 888, 3628, 3388, 3171, 1879, 1774, 600, 220, 188, 3630, 2708, 2655, 1917, 3183, 2735, 1776, 686, 3263, 3100, 2919, 1806, 1652, 847, 3158, 1824, 1033, 953, 553, 545, 3264, 3203, 1432, 328, 2074, 757, 3535, 3421, 1305, 753, 3451, 3140, 2498, 366, 3598, 2942, 2885, 2737, 2602, 1560, 1506, 1485, 1291, 902, 828, 534, 156, 3412, 2866, 2287, 2095, 1855, 1832, 1039, 910, 3310, 2997, 1576, 550, 420, 326, 166, 3474, 3350, 2178, 1971, 1787, 1740, 1278, 818, 3312, 2316, 2201, 1792, 1643, 1602, 1006, 720, 265, 2889, 850, 205, 133, 114, 3374, 2824, 1146, 776, 376, 122, 3850, 3774, 2827, 2394, 1756, 1538, 744, 347, 223, 3475, 3414, 2926, 2478, 2352, 1399, 1106, 237, 2818, 2639, 2518, 2499, 1966, 1881, 1623, 3832, 3260, 3129, 1415, 554, 2673, 1334])
blogcatalog_top = list([232, 8269, 1680, 9525, 4651, 6958, 4983, 9843, 4838, 4373, 3261, 458, 1008, 8972, 3338, 1326, 4946, 175, 8475, 3406, 448, 2998, 6057, 738, 5624, 10139, 8156, 2326, 1985, 4668, 1225, 3396, 7805, 1000, 1195, 9918, 6872, 3101, 644, 10, 3769, 7097, 745, 4996, 3607, 5555, 725, 14, 1151, 9480, 3121, 5029, 6034, 9357, 2623, 6070, 9996, 6427, 555, 577, 7060, 3560, 6633, 9943, 9122, 225, 7988, 7532, 806, 8774, 6949, 1931, 6747, 3197, 9419, 8978, 6910, 3527, 614, 4583, 1401, 829, 5258, 4930, 5767, 9820, 5844, 5680, 3657, 666, 445, 7450, 7372, 8524, 4455, 2627, 1864, 9516, 5284, 6104, 1451, 5730, 532, 7681, 7495, 3829, 2368, 2240, 1409, 6389, 6372, 9708, 268, 10287, 2624, 3275, 1886, 1245, 910, 5771, 877, 9187, 8858, 4707, 4214, 1702, 6114, 2902, 2312, 1283, 9185, 275, 6396, 3425, 6090, 8867, 6107, 6072, 4647, 4255, 287, 8755, 3055, 8943, 2215, 7701, 6727, 6000, 4804, 1412, 6685, 6186, 711, 8927, 6434, 4621, 3223, 1046, 997, 5230, 4732, 2350, 9875, 9104, 6454, 3525, 3461, 1433, 1373, 1145, 8588, 8366, 6569, 5666, 4134, 3295, 2954, 1108, 393, 290, 5067, 2996, 4489, 3754, 3907, 2774, 2785, 2531, 1730, 8887, 4512, 2795, 342, 8139, 8083, 6758, 6468, 414, 2155, 1977, 525, 8323, 6812, 3926, 3858, 3750, 2494, 661, 8647, 3689, 2511, 1841, 1282, 363, 8627, 6871, 4789, 2976, 499, 6592, 2860, 135, 9058, 6859, 4087, 3537, 2695, 702, 173, 10268, 8179, 4842, 2204, 9968, 4161, 3873, 3764, 282, 8893, 6956, 4068, 3796, 2637, 3138, 797, 160, 8529, 7380, 5566, 3857, 3606, 3400, 1442, 1056, 8301, 6550, 6140, 3578, 2230, 1810, 6359, 6128, 5322, 5631, 5255, 1366, 6385, 3333, 3268, 2937, 2833, 1285, 858, 8560, 5084, 3113, 8796, 6175, 5150, 1291, 1217, 583, 91, 8637, 7926, 6877, 6707, 6331, 5545, 4547, 3497, 3450, 950, 857, 640, 543, 399, 7421, 2084, 190, 40, 7841, 7304, 5687, 4994, 4309, 1823, 1473, 1135, 9372, 5003, 2649, 2520, 207, 9652, 9564, 8440, 8233, 7365, 6340, 6054, 3489, 2992, 2907, 1309, 646, 245, 8938, 8054, 6661, 6304, 5151, 2731, 2442, 2069, 1951, 7085, 6113, 4496, 3154, 3091, 925, 340, 7223, 6714, 5716, 5489, 5171, 4153, 3385, 2108, 1272, 650, 429, 228, 6174, 5465, 5004, 3992, 9215, 8247, 6687, 5606, 5068, 4858, 4795, 3082, 2596, 2202, 1903, 942, 8816, 8790, 6767, 5376, 1842, 1664, 754, 505, 12, 8451, 7894, 6748, 5215, 4766, 4500, 2516, 2076, 1434, 964, 15, 8602, 8346, 7575, 7414, 6647, 4664, 2940, 2818, 2664, 1523, 394, 9963, 8889, 8334, 6640, 6539, 6071, 5428, 5152, 4101, 3701, 2453, 1705, 969, 883, 8638, 8091, 7130, 6763, 6512, 5996, 4384, 4348, 4230, 4131, 2610, 2447, 2184, 2065, 1346, 918, 586, 209, 10248, 7921, 6724, 6565, 6415, 5493, 5449, 5264, 4108, 4079, 3851, 1402, 352, 27, 8420, 7200, 6906, 5568, 4907, 3733, 3087, 3036, 2226, 2032, 1566, 1330, 970, 9295, 8386, 8107, 4593, 4560, 4263, 1876, 1875, 678, 392, 82, 10191, 6546, 6112, 5849, 5543, 5203, 3550, 3239, 2802, 1643, 473, 346, 243, 9911, 9138, 8309, 7247, 4826, 3878, 3476, 2621, 2099, 802, 568, 447, 364, 71, 9435, 9259, 7359, 3360, 3322, 2831, 2337, 2195, 1295, 1104, 730, 527, 10224, 8158, 7374, 6638, 5885, 5604, 4993, 3559, 3409, 2536, 2199, 2034, 549, 9527, 7551, 7307, 7234, 6016, 5975, 5002, 4506, 3742, 3366, 2611, 2550, 2415, 1935, 1739, 1074, 811, 8500, 7131, 6272, 5392, 4757, 4114, 3625, 3258, 3050, 2357, 2048, 1733, 573, 483, 475, 9026, 8826, 8553, 5373, 4565, 3962, 3334, 2597, 1455, 570, 194, 85, 81, 7970, 7227, 6316, 6235, 5742, 5345, 4678, 3935, 3414, 2823, 2380, 2279, 2260, 2036, 1845, 1704, 1155, 204, 8497, 6618, 6456, 4835, 4724, 4671, 4612, 4530, 4004, 2799, 2341, 2185, 1635, 1594, 1533, 1190, 347, 48, 9181, 8028, 7360, 6211, 5930, 5235, 2482, 1416, 1385, 833, 8100, 8053, 7026, 6630, 5924, 5660, 5424, 5190, 4444, 3819, 3741, 3693, 3257, 3094, 3072, 2043, 1821, 356, 218, 0, 9832, 9478, 9152, 9097, 7292, 7204, 5721, 5193, 4245, 3351, 3265, 3212, 2651, 1737, 1576, 1568, 995, 605, 10296, 9692, 8395, 7636, 6976, 6286, 4960, 4328, 3656, 3146, 3145, 774, 638, 373, 233, 9644, 9444, 7839, 7191, 6222, 5162, 4598, 4541, 3973, 3856, 3140, 1912, 1494, 1234, 985, 61, 35, 9822, 8180, 7017, 6831, 6815, 5905, 5835, 5098, 5090, 4827, 4599, 4503, 3776, 3740, 3192, 2914, 2697, 2303, 1779, 762, 518, 8916, 6885, 6804, 5221, 5189, 5050, 5008, 3643, 3448, 3059, 2882, 1890, 1806, 1683, 541, 294, 9886, 7375, 7064, 6899, 6260, 6065, 6003, 5704, 2391, 1724, 47, 32, 9829, 9524, 9171, 8862, 7217, 7009, 6829, 6806, 6481, 5636, 4195, 3902, 2952, 1516, 998, 712, 348, 322, 8556, 8479, 7420, 5940, 4870, 4158, 4021, 3602, 2331, 2057, 1873, 1867, 1454, 775, 341, 10040, 9704, 9586, 9077, 8680, 7838, 7128, 6726, 6704, 5843, 4722, 4535, 4413, 4379, 4100, 3649, 3526, 1934, 1493, 1463, 9503, 9349, 8382, 7579, 6369, 5926, 5852, 5484, 5375, 5220, 4813, 4389, 3723, 2225, 1982, 1754, 1637, 791, 619, 9218, 7925, 7561, 6985, 6914, 6562, 6354, 5594, 5584, 5111, 4961, 4850, 4414, 4403, 4218, 4135, 4124, 3465, 2861, 2773, 2557, 1159, 849, 827, 212, 183, 8932, 8735, 8221, 8094, 7564, 6843, 5699, 5633, 5504, 5497, 5425, 5138, 4495, 4150, 3893, 3222, 1577, 1380, 1226, 1166, 1150, 481, 64, 9847, 9482, 7500, 7321, 6916, 5177, 5141, 5100, 4901, 4685, 4287, 4237, 3229, 2665, 2636, 2209, 2117, 8991, 8840, 8631, 8603, 8062, 7964, 7929, 7436, 6317, 5784, 4190, 4023, 3416, 2186, 2114, 2061, 2030, 2028, 1999, 1458, 1320, 1219, 10028, 9889, 9397, 8698, 8314, 8299, 8238, 6757, 5663, 5240, 5185, 5183, 5034, 4427, 4406, 4349, 3906, 3488, 2721, 2187, 1897, 1162, 1109, 837, 799, 10012, 9675, 9673, 9439, 9091, 8437, 8373, 8295, 6691, 6612, 6577, 5783, 5635, 5628, 5226, 4744, 4490, 4419, 4416, 4277, 3724, 3604, 3235, 2173, 1794, 1781, 606, 372, 127, 38, 10067, 9848, 9793, 9161, 8762, 8456, 7794, 7624, 7589, 6641, 6544, 6410, 5502, 4836, 4009, 3822, 3725, 3502, 3181, 2810, 2535, 2394, 2091, 1761, 1388, 1341, 990, 627, 376, 230, 66, 9987, 9354, 9262, 8784, 8767, 8416, 7753, 7623, 7325, 5944, 5873, 5197, 4894, 4313, 4146, 4049, 3797, 3712, 2987, 2352])
wikipedia_top = list([2, 1, 3, 6, 5, 4, 11, 8, 7, 13, 9, 16, 14, 12, 24, 10, 89, 22, 80, 17, 19, 25, 2406, 15, 40, 20, 35, 28, 619, 1171, 977, 30, 57, 18, 4565, 2083, 187, 473, 27, 3285, 132, 33, 156, 865, 26, 95, 37, 36, 862, 239, 21, 4602, 4190, 303, 123, 112, 92, 32, 23, 499, 1334, 150, 3057, 254, 1980, 1640, 786, 596, 103, 3784, 815, 86, 45, 1061, 983, 736, 726, 235, 101, 73, 31, 4124, 567, 333, 58, 1955, 668, 510, 396, 346, 2755, 2443, 1082, 914, 377, 47, 1907, 1407, 512, 356, 169, 130, 97, 52, 51, 3699, 2696, 1256, 569, 370, 336, 91, 29, 2203, 1219, 1111, 65, 42, 1624, 1101, 717, 265, 75, 66, 2413, 2055, 1932, 1926, 1140, 719, 555, 108, 43, 2865, 2816, 1550, 490, 330, 266, 3685, 1838, 710, 620, 69, 64, 2910, 2768, 2303, 789, 528, 287, 76, 39, 3853, 3768, 3710, 1650, 1481, 1238, 527, 350, 328, 268, 233, 70, 50, 44, 38, 3828, 3052, 2906, 2344, 2129, 1947, 1491, 1371, 242, 188, 172, 158, 74, 62, 4714, 2898, 2821, 2726, 2629, 2272, 2034, 1515, 1429, 1015, 641, 375, 315, 297, 223, 4168, 4086, 2665, 1982, 1887, 1599, 1471, 818, 768, 661, 340, 295, 250, 3978, 3370, 3294, 2462, 1933, 1871, 1390, 1227, 1208, 1056, 613, 479, 421, 284, 207, 142, 78, 72, 3935, 3070, 2973, 2882, 2846, 2174, 2144, 1764, 1756, 1742, 1136, 491, 363, 314, 197, 168, 139, 129, 116, 90, 59, 4189, 4090, 3731, 3573, 2920, 2764, 2319, 1749, 1000, 933, 774, 352, 304, 237, 205, 143, 93, 82, 41, 34, 4508, 4506, 4447, 4135, 3991, 3502, 3346, 2737, 2535, 2353, 1807, 1723, 1397, 1086, 898, 653, 598, 456, 199, 4394, 3665, 2365, 1866, 990, 838, 741, 732, 585, 536, 438, 388, 286, 190, 134, 100, 85, 48, 4533, 4069, 3595, 3251, 2505, 2079, 1882, 1842, 1763, 1379, 1217, 1201, 1166, 900, 867, 841, 723, 694, 603, 515, 423, 236, 220, 81, 4500, 4443, 3892, 3805, 3453, 2986, 2732, 2628, 2604, 2440, 2414, 2173, 1264, 1239, 1190, 1188, 1035, 997, 866, 857, 667, 616, 485, 344, 322, 316, 283, 262, 259, 160, 157, 131, 127, 61, 4436, 4043, 3505, 3445, 3236, 3013, 2875, 2123, 1922, 1921, 1625, 1432, 1430, 1392, 1367, 1314, 1065, 890, 677, 670, 625, 606, 570, 502, 437, 429, 386, 368, 305, 248, 177, 84, 83, 67, 4253, 3902, 3354, 3233, 2609, 1772, 1636, 1338, 1244, 1150, 1034, 919, 738, 608, 574, 342, 306, 232, 202, 186, 147, 140, 102, 3956, 3568, 3367, 3310, 3169, 3029, 3016, 2735, 2270, 2227, 2137, 1777, 1702, 1457, 1452, 1127, 1108, 1041, 994, 976, 973, 910, 816, 586, 546, 506, 380, 372, 243, 229, 226, 179, 159, 138, 133, 122, 98, 4155, 3879, 3803, 3022, 2947, 2651, 2329, 2182, 2065, 1718, 1448, 1106, 884, 880, 709, 599, 545, 532, 509, 457, 430, 337, 274, 166, 163, 145, 111, 110, 107, 77, 63, 4226, 4051, 3742, 3702, 3683, 3626, 3602, 3399, 3307, 3145, 2926, 2461, 2282, 2224, 2102, 1902, 1674, 1473, 1431, 1250, 1210, 1149, 1096, 1055, 1002, 962, 943, 821, 662, 643, 597, 454, 282, 280, 183, 151, 149, 87, 49, 4624, 4458, 4317, 4235, 4004, 3839, 3830, 3601, 3230, 3191, 3125, 2936, 2694, 2682, 2596, 2591, 2489, 2470, 2380, 2231, 2210, 2199, 1958, 1862, 1671, 1585, 1551, 1544, 1428, 1260, 1110, 1044, 961, 935, 704, 692, 675, 650, 447, 446, 428, 409, 405, 389, 382, 379, 373, 293, 175, 152, 94, 53, 46, 4753, 4507, 4143, 4007, 3875, 3869, 3741, 3474, 3276, 3151, 3083, 2863, 2742, 2570, 2502, 2340, 2167, 1946, 1900, 1859, 1818, 1816, 1810, 1809, 1632, 1631, 1455, 1415, 1414, 1247, 1187, 1103, 1049, 980, 854, 762, 718, 681, 671, 636, 556, 471, 441, 398, 281, 247, 218, 194, 167, 118, 56, 4612, 4605, 4574, 4566, 4521, 4509, 4122, 4070, 3981, 3961, 3580, 3451, 3412, 3101, 3011, 2895, 2867, 2714, 2592, 2464, 2384, 2149, 2115, 2044, 1918, 1753, 1703, 1511, 1424, 1387, 1307, 1300, 1168, 1133, 1059, 1028, 985, 847, 827, 743, 721, 712, 444, 395, 279, 214, 212, 114, 104, 88, 68, 4698, 4678, 4415, 4330, 4175, 4138, 3857, 3824, 3775, 3727, 3644, 3406, 3345, 3334, 3227, 3168, 3165, 3092, 3037, 3017, 2999, 2889, 2834, 2818, 2658, 2512, 2393, 2375, 2370, 2263, 2252, 2111, 2047, 2029, 1899, 1822, 1775, 1681, 1664, 1597, 1588, 1513, 1507, 1365, 1186, 995, 939, 877, 869, 836, 825, 759, 727, 691, 591, 526, 495, 462, 415, 354, 326, 313, 302, 300, 148, 119, 55, 4694, 4664, 4452, 4268, 4059, 3969, 3867, 3822, 3592, 3351, 3289, 3238, 3156, 3147, 3142, 2904, 2744, 2743, 2689, 2666, 2631, 2577, 2474, 2444, 2430, 2397, 2273, 2269, 2162, 2121, 2095, 2046, 1994, 1937, 1879, 1856, 1680, 1629, 1626, 1622, 1610, 1571, 1566, 1499, 1477, 1362, 1325, 1282, 1277, 1252, 1246, 1232, 1119, 1102, 1042, 954, 901, 858, 796, 711, 656, 614, 588, 562, 504, 439, 362, 327, 256, 206, 174, 128, 4771, 4733, 4579, 4474, 4382, 4357, 4343, 4272, 4197, 4137, 4024, 3938, 3886, 3837, 3724, 3697, 3649, 3628, 3607, 3562, 3388, 3296, 3273, 3216, 3207, 3193, 3127, 3081, 2900, 2800, 2738, 2729, 2719, 2420, 2391, 2258, 2238, 2213, 2197, 2180, 2069, 2052, 2027, 2023, 2012, 1990, 1984, 1979, 1957, 1952, 1847, 1731, 1653, 1648, 1643, 1620, 1595, 1591, 1558, 1296, 1287, 1259, 1159, 1137, 1084, 1079, 1077, 899, 874, 852, 802, 792, 687, 631, 617, 589, 550, 549, 513, 496, 478, 474, 448, 390, 320, 307, 298, 272, 253, 246, 195, 144, 137, 136, 105, 99, 60, 54, 4743, 4550, 4503, 4494, 4336, 3845, 3811, 3792, 3790, 3720, 3655, 3539, 3467, 3429, 3353, 3271, 3080, 2750, 2691, 2645, 2600, 2576, 2568, 2534, 2321, 2184, 2171, 2127, 2063, 2008, 1956, 1765, 1758, 1661, 1627, 1557, 1545, 1528, 1357, 1229, 1215, 1174, 1152, 1126, 1076, 1075, 1062, 1053, 996, 972, 913, 889, 875, 822, 800, 772, 769, 760, 611, 592, 417, 399, 351, 334, 299, 260, 230, 162, 125, 117, 115, 106, 4709, 4668, 4596, 4554, 4478, 4366, 4211, 4209])
egofacebook_top = list([290, 289, 288, 1, 291, 2688, 292, 769, 1323, 1033, 974, 2143, 1995, 1937, 2630, 1827, 1373, 2440, 1415, 1008, 779, 2250, 2216, 2004, 1391, 1345, 1115, 1020, 925, 2192, 2170, 2141, 1275, 1118, 1036, 971, 938, 932, 880, 855, 2483, 2299, 2226, 2214, 2212, 2022, 1906, 1513, 1499, 1424, 1242, 1133, 454, 191, 2204, 2131, 2108, 2074, 2064, 1932, 1912, 1887, 1869, 1868, 1430, 1164, 1131, 1109, 1082, 1011, 953, 877, 796, 582, 431, 251, 2510, 2417, 2395, 2372, 2351, 2200, 2198, 2031, 1979, 1870, 1648, 1375, 1370, 1353, 1329, 1310, 1303, 1261, 1193, 1059, 1037, 999, 937, 916, 861, 851, 835, 830, 829, 828, 798, 783, 647, 628, 544, 422, 176, 43, 2499, 2471, 2463, 2462, 2439, 2374, 2336, 2185, 2177, 2155, 2086, 2081, 2027, 2021, 1998, 1990, 1960, 1959, 1949, 1908, 1894, 1485, 1448, 1338, 1297, 1296, 1213, 1209, 1172, 1155, 1122, 987, 952, 933, 931, 817, 803, 790, 785, 782, 759, 751, 724, 716, 592, 584, 529, 502, 493, 484, 467, 464, 451, 329, 282, 149, 2534, 2519, 2495, 2490, 2475, 2469, 2442, 2435, 2389, 2358, 2337, 2309, 2306, 2304, 2293, 2277, 2248, 2238, 2205, 2138, 2127, 2124, 2109, 2040, 1926, 1865, 1864, 1853, 1523, 1493, 1483, 1474, 1452, 1429, 1402, 1362, 1352, 1304, 1290, 1266, 1257, 1247, 1228, 1226, 1200, 1137, 1123, 1080, 1067, 1066, 1042, 1017, 986, 936, 918, 915, 811, 728, 727, 710, 670, 658, 549, 546, 532, 526, 450, 430, 409, 342, 325, 82, 72, 57, 2856, 2444, 2431, 2428, 2405, 2360, 2357, 2348, 2339, 2318, 2296, 2251, 2220, 2190, 2182, 2149, 2111, 2092, 2088, 2063, 2054, 2017, 2006, 1915, 1879, 1852, 1671, 1556, 1536, 1526, 1522, 1472, 1456, 1449, 1433, 1426, 1421, 1388, 1385, 1366, 1361, 1355, 1324, 1241, 1238, 1205, 1201, 1181, 1161, 1158, 1135, 1127, 1105, 1052, 1040, 1034, 1025, 983, 963, 962, 906, 903, 900, 899, 896, 895, 852, 842, 826, 808, 801, 784, 749, 742, 722, 715, 708, 695, 635, 581, 553, 547, 543, 519, 499, 489, 478, 439, 398, 210, 173, 142, 86, 70, 56, 12, 2857, 2822, 2820, 2813, 2782, 2705, 2605, 2532, 2516, 2476, 2411, 2369, 2364, 2343, 2338, 2301, 2278, 2221, 2217, 2199, 2166, 2110, 2077, 2057, 2029, 1988, 1970, 1951, 1941, 1899, 1891, 1841, 1823, 1794, 1743, 1668, 1637, 1610, 1606, 1582, 1574, 1571, 1565, 1497, 1486, 1475, 1462, 1437, 1436, 1364, 1357, 1272, 1174, 1140, 1128, 1126, 1114, 1098, 1048, 979, 949, 873, 859, 775, 771, 748, 746, 718, 700, 650, 638, 617, 550, 522, 500, 482, 458, 443, 441, 428, 408, 381, 359, 337, 332, 315, 227, 222, 175, 170, 166, 146, 46, 29, 2855, 2851, 2826, 2766, 2758, 2754, 2749, 2731, 2714, 2701, 2696, 2693, 2641, 2625, 2616, 2606, 2594, 2567, 2498, 2397, 2393, 2349, 2335, 2310, 2300, 2239, 2174, 2173, 2090, 2080, 2067, 2045, 2039, 2024, 1952, 1905, 1801, 1761, 1709, 1698, 1680, 1663, 1657, 1656, 1654, 1620, 1614, 1600, 1597, 1587, 1577, 1553, 1549, 1546, 1539, 1503, 1459, 1451, 1322, 1289, 1288, 1282, 1271, 1153, 1058, 980, 935, 913, 907, 881, 848, 836, 822, 756, 736, 689, 665, 637, 631, 622, 590, 586, 576, 562, 558, 541, 539, 533, 527, 520, 508, 490, 488, 455, 432, 424, 413, 410, 407, 394, 390, 389, 369, 362, 314, 270, 264, 241, 238, 226, 223, 220, 190, 160, 152, 128, 118, 117, 116, 113, 100, 66, 65, 49, 11, 2881, 2873, 2861, 2860, 2854, 2819, 2816, 2812, 2791, 2781, 2779, 2774, 2769, 2762, 2753, 2734, 2733, 2730, 2727, 2726, 2713, 2711, 2708, 2707, 2685, 2672, 2658, 2644, 2627, 2623, 2611, 2610, 2597, 2591, 2587, 2586, 2583, 2580, 2566, 2560, 2557, 2546, 2538, 2535, 2445, 2414, 2350, 2344, 2308, 2265, 2256, 2249, 2148, 2139, 2098, 2071, 1996, 1947, 1889, 1817, 1807, 1793, 1792, 1791, 1781, 1764, 1756, 1754, 1749, 1730, 1725, 1721, 1717, 1681, 1674, 1641, 1629, 1623, 1612, 1608, 1596, 1585, 1580, 1578, 1550, 1473, 1464, 1187, 1147, 1016, 991, 898, 753, 745, 739, 720, 673, 669, 597, 579, 578, 552, 476, 469, 419, 397, 357, 346, 343, 338, 305, 295, 293, 245, 215, 177, 168, 156, 155, 144, 140, 139, 136, 129, 106, 68, 17, 2880, 2869, 2867, 2865, 2849, 2844, 2840, 2832, 2821, 2814, 2810, 2807, 2805, 2801, 2800, 2778, 2773, 2757, 2748, 2740, 2724, 2720, 2703, 2681, 2664, 2663, 2652, 2634, 2624, 2614, 2613, 2585, 2578, 2569, 2558, 2536, 2147, 2065, 1967, 1812, 1783, 1771, 1762, 1669, 1659, 1650, 1632, 1631, 1628, 1624, 1605, 1599, 1572, 1568, 1567, 1552, 1528, 1390, 951, 723, 685, 607, 604, 599, 573, 487, 449, 402, 385, 366, 333, 327, 279, 265, 247, 204, 194, 180, 165, 147, 132, 87, 59, 28, 22, 2888, 2887, 2886, 2885, 2884, 2883, 2882, 2879, 2878, 2877, 2876, 2875, 2874, 2872, 2871, 2870, 2868, 2866, 2864, 2863, 2862, 2859, 2858, 2853, 2852, 2850, 2848, 2847, 2846, 2845, 2843, 2842, 2841, 2839, 2838, 2837, 2836, 2835, 2834, 2833, 2831, 2830, 2829, 2828, 2827, 2825, 2824, 2823, 2818, 2817, 2815, 2811, 2809, 2808, 2806, 2804, 2803, 2802, 2799, 2798, 2797, 2796, 2795, 2794, 2793, 2792, 2790, 2789, 2788, 2787, 2786, 2785, 2784, 2783, 2780, 2777, 2776, 2775, 2772, 2771, 2770, 2768, 2767, 2765, 2764, 2763, 2761, 2760, 2759, 2756, 2755, 2752, 2751, 2750, 2747, 2746, 2745, 2744, 2743, 2742, 2741, 2739, 2738, 2737, 2736, 2735, 2732, 2729, 2728, 2725, 2723, 2722, 2721, 2719, 2718, 2717, 2716, 2715, 2712, 2710, 2709, 2706, 2704, 2702, 2700, 2699, 2698, 2697, 2695, 2694, 2692, 2691, 2690, 2689, 2687, 2686, 2684, 2683, 2682, 2680, 2679, 2678, 2677, 2676, 2675, 2674, 2673, 2671, 2670, 2669, 2668, 2667, 2666, 2665, 2662, 2661, 2660, 2659, 2657, 2656, 2655, 2654, 2653, 2651, 2650, 2649, 2648, 2647, 2646, 2645, 2643, 2642, 2640, 2639, 2638, 2637, 2636, 2635, 2633, 2632, 2631, 2629, 2628, 2626, 2622, 2621, 2620, 2619, 2618, 2617, 2615, 2612, 2609, 2608, 2607, 2604, 2603, 2602, 2601, 2600, 2599, 2598, 2596, 2595, 2593, 2592, 2590, 2589, 2588, 2584, 2582, 2581, 2579, 2577, 2576, 2575, 2574, 2573, 2572, 2571, 2570, 2568, 2565, 2564, 2563, 2562, 2561, 2559, 2556])
yeast_top = list([240, 131, 61, 34, 250, 424, 241, 277, 120, 399, 418, 396, 79, 269, 249, 41, 710, 28, 415, 426, 35, 821, 403, 400, 417, 404, 410, 407, 231, 457, 379, 239, 232, 555, 255, 55, 413, 475, 519, 122, 19, 123, 381, 362, 39, 1001, 983, 1246, 1673, 398, 76, 423, 411, 810, 421, 401, 934, 1472, 1440, 1343, 408, 948, 191, 132, 1658, 815, 1324, 430, 99, 1095, 189, 119, 322, 1839, 246, 140, 234, 31, 453, 1149, 1291, 295, 882, 319, 1373, 86, 472, 1481, 1496, 276, 416, 1163, 37, 1312, 94, 300, 1794, 412, 188, 635, 429, 236, 773, 557, 395, 406, 818, 1516, 1582, 1617, 219, 1096, 1797, 590, 245, 880, 248, 1127, 714, 930, 1102, 641, 376, 627, 986, 321, 1550, 81, 1433, 1405, 206, 433, 98, 909, 517, 1039, 974, 760, 769, 1896, 42, 949, 1815, 1234, 127, 1461, 84, 129, 1007, 1130, 957, 425, 182, 97, 100, 63, 29, 1478, 498, 14, 1927, 481, 732, 1856, 1795, 22, 647, 96, 1660, 755, 414, 409, 186, 1121, 225, 1153, 889, 102, 1309, 494, 1237, 852, 594, 125, 1695, 215, 1418, 1876, 764, 887, 895, 20, 883, 840, 1124, 1071, 469, 1749, 87, 95, 1427, 945, 1837, 1287, 609, 1925, 606, 1627, 1838, 420, 500, 1446, 820, 497, 301, 455, 1204, 432, 1053, 1129, 117, 1049, 1721, 402, 365, 1571, 1060, 558, 1097, 169, 1377, 265, 742, 272, 92, 1247, 762, 58, 1434, 977, 720, 1286, 1136, 1111, 703, 1335, 1160, 1122, 1119, 315, 479, 1188, 817, 507, 837, 1570, 898, 836, 1314, 327, 1471, 332, 984, 440, 759, 982, 57, 855, 1220, 1165, 495, 1360, 1212, 1725, 354, 259, 658, 527, 18, 1181, 82, 1185, 1175, 813, 631, 436, 80, 975, 1877, 1842, 1923, 1493, 89, 608, 91, 1126, 260, 1532, 1179, 474, 999, 600, 1924, 1213, 1123, 1323, 254, 1311, 1743, 1101, 1068, 1038, 44, 1349, 437, 1016, 397, 7, 492, 1341, 289, 1850, 1099, 1598, 704, 1629, 85, 541, 1621, 1803, 1350, 83, 888, 1788, 709, 93, 846, 1166, 669, 266, 1093, 187, 168, 803, 161, 1171, 625, 853, 21, 926, 833, 969, 273, 1663, 30, 384, 1040, 1423, 1374, 1117, 814, 1899, 1120, 467, 614, 392, 280, 486, 288, 1230, 1047, 1034, 701, 1861, 222, 1118, 1113, 699, 405, 1748, 1425, 1635, 1054, 671, 27, 1064, 928, 1781, 1168, 1935, 1642, 907, 879, 1394, 1058, 605, 118, 1277, 419, 54, 1302, 1651, 148, 1004, 1392, 642, 503, 1460, 1255, 1174, 1942, 1125, 371, 1115, 553, 1385, 823, 1538, 1639, 535, 1313, 461, 1851, 870, 1569, 171, 958, 776, 422, 1573, 1529, 1059, 816, 493, 770, 451, 1670, 1626, 1216, 913, 550, 802, 334, 9, 593, 885, 988, 1871, 1510, 1417, 690, 1857, 954, 1645, 807, 1860, 1849, 1482, 323, 33, 32, 683, 1859, 128, 1637, 1184, 77, 1525, 1310, 560, 892, 330, 676, 991, 847, 228, 1156, 1322, 664, 1694, 1326, 1108, 179, 878, 851, 692, 290, 1161, 1098, 1357, 270, 1495, 677, 1346, 1236, 1173, 116, 1524, 1169, 1759, 1504, 893, 835, 1092, 1359, 1199, 559, 389, 1744, 1128, 154, 868, 1441, 1148, 540, 115, 38, 1231, 347, 1444, 367, 1689, 1470, 1378, 146, 1551, 1035, 518, 466, 1159, 1094, 924, 1638, 551, 819, 794, 464, 1755, 1225, 1083, 1644, 1107, 1566, 973, 157, 1257, 1027, 1705, 1078, 796, 534, 1870, 1112, 229, 1740, 320, 1579, 985, 754, 1057, 886, 441, 121, 1758, 1114, 1691, 598, 1164, 884, 696, 1157, 1382, 566, 252, 235, 1581, 1281, 1240, 1137, 726, 480, 380, 602, 1649, 1304, 368, 1358, 894, 1869, 66, 914, 864, 1155, 1362, 1100, 832, 1591, 967, 227, 1683, 1648, 1052, 496, 1422, 1395, 1646, 1375, 1386, 632, 442, 1376, 1154, 1003, 258, 716, 359, 1958, 473, 1904, 1520, 378, 177, 1019, 452, 285, 1380, 1284, 795, 428, 1361, 1224, 611, 364, 1172, 691, 468, 834, 1647, 1531, 1116, 808, 377, 4, 1415, 705, 1477, 233, 1835, 1021, 792, 1873, 1076, 1036, 1456, 1428, 1248, 1865, 1371, 1724, 1585, 1006, 1922, 1672, 1180, 1613, 950, 626, 1575, 689, 955, 917, 667, 576, 1696, 1580, 299, 1032, 830, 786, 287, 113, 916, 589, 353, 621, 1643, 159, 133, 2, 1941, 465, 1292, 1077, 1211, 610, 346, 1778, 431, 1089, 544, 1858, 1151, 1518, 562, 1587, 1191, 938, 1597, 1072, 601, 1798, 1589, 848, 673, 484, 1379, 356, 1751, 1712, 1951, 1908, 1443, 1325, 1260, 891, 1396, 1365, 670, 1728, 1636, 1630, 1162, 435, 961, 693, 499, 264, 88, 947, 170, 1, 1874, 1562, 1384, 1029, 1005, 547, 504, 307, 1568, 1437, 1296, 256, 205, 1841, 1445, 782, 1698, 684, 1190, 923, 563, 905, 226, 1605, 1245, 1457, 1158, 793, 789, 881, 554, 1306, 237, 36, 662, 592, 1565, 1559, 1301, 1872, 1152, 987, 271, 1796, 761, 731, 666, 1906, 1263, 1480, 1388, 268, 1886, 1769, 363, 292, 1340, 1265, 1051, 1018, 858, 314, 1901, 1675, 1595, 1556, 904, 612, 516, 1539, 698, 308, 298, 111, 24, 1269, 1474, 711, 230, 1885, 1214, 772, 694, 1170, 646, 536, 126, 60, 1914, 1963, 1734, 1258, 781, 725, 1219, 510, 1141, 771, 1679, 1611, 1442, 291, 253, 1318, 1063, 665, 1688, 515, 383, 190, 1964, 328, 1542, 1500, 1706, 1221, 1073, 702, 1381, 78, 46, 1898, 1316, 525, 1739, 1501, 910, 839, 180, 1944, 675, 64, 1261, 700, 56, 805, 1041, 1488, 561, 1315, 674, 1288, 956, 941, 784, 1473, 1044, 685, 1726, 587, 1283, 1259, 1088, 640, 1926, 1652, 1526, 1183, 1081, 1354, 757, 733, 483, 438, 911, 471, 195, 1356, 1262, 953, 936, 758, 922, 1555, 844, 785, 706, 508, 1654, 1489, 925, 728, 724, 687, 548, 331, 317, 1492, 735, 1426, 995, 342, 1664, 1307, 791, 1256, 1697, 1203, 736, 247, 178, 1241, 804, 712, 695, 50, 1631, 1574, 780, 279, 944, 727, 1717, 1710, 1546, 343, 218, 1483, 1192, 586, 155, 1398, 1372, 1110, 1017, 866, 688, 617, 242, 62, 1718, 1303, 719, 388, 138, 1727, 1661, 1534, 1463, 1276, 1178, 1084, 737, 659, 639, 478, 336, 160, 8, 1469, 352, 1389, 996, 581, 167, 1715, 1167, 1070, 806])

# ---------------------------------------------------------------
#
# Function to load the specified dataset and place it in a
# NetworkX Graph structure, removing self loops and isolated
# nodes from the graph.
# @param: file - the name of the input file
# @param: variable_name - data structure
# @return: G - NetworkX graph of the dataset without self loops
#              and isolated nodes
# ---------------------------------------------------------------
def load_graph(file):
    os.chdir("../datasets")
    if ".mat" in file:
        raw_data = scipy.io.loadmat(file, squeeze_me=True)
        variable_name = "network"
        data = raw_data[variable_name]
        logger.info("loading mat file %s", file)
        G = nx.to_networkx_graph(data, create_using=nx.Graph, multigraph_input=False)
    if ".gml" in file:
        logger.info("loading gml file %s", file)
        G = nx.read_gml(file, label="id")
    else:
        logger.info("loading txt file %s", file)
        G = nx.read_edgelist(file, create_using=nx.Graph)
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    G.remove_nodes_from(list(nx.isolates(G)))
    mapping = dict(zip(G, range(0, len(list(G.nodes())))))
    G = nx.relabel_nodes(G, mapping)
    return G


# ---------------------------------------------------------------
#
# Function to load the specified dataset and place it in a
# NetworkX Graph structure.
# @param: file - the name of the input file
# @param: variable_name - data structure
# @return: G - NetworkX graph of the dataset
# ---------------------------------------------------------------
def load_default_graph(file):
    os.chdir("../datasets")
    if ".mat" in file:
        raw_data = scipy.io.loadmat(file, squeeze_me=True)
        variable_name = "network"
        data = raw_data[variable_name]
        logger.info("loading mat file %s", file)
        G = nx.to_networkx_graph(data, create_using=nx.Graph, multigraph_input=False)
    if ".gml" in file:
        logger.info("loading gml file %s", file)
        G = nx.read_gml(file, label="id")
    else:
        logger.info("loading txt file %s", file)
        G = nx.read_edgelist(file, create_using=nx.Graph, nodetype=int)
    return G

# ---------------------------------------------------------------
#
# Function to find the neighborhood of a node, which can be of
# different level specified by the cutoff, in the graph passed.
# @param: G - the graph
# @param: node - the node of which we have to find neighbors
# @param: level - the level specifying the cutoff on path length
#                 from initial node
# @return: res - all the nodes being in a level-neighborhood (does
#                nor return the initial node in the neighborhood)
# ---------------------------------------------------------------
def neighborhood(G, node, level):
    res = nx.single_source_dijkstra_path_length(G, node, cutoff=level)
    del res[node]
    return res

# does return the initial node as part of the neighborhood
def neighborhood_including_node(G, node, level):
    res = nx.single_source_dijkstra_path_length(G, node, cutoff=level)
    return res


# ---------------------------------------------------------------
#
# Loading graph and its DeepWalk embedding
# @param: file - the name of the input file
# @param: variable_name - data structure
# @return: G, embedding - NetworkX graph of the network in the
#                         input file and its embedding (DeepWalk)
# ---------------------------------------------------------------
def deepwalk_embedding(file):
    G = load_graph(file)
    N = G.number_of_nodes()
    r = math.ceil(N/2)
    dim = min(128, r)
    logger.info("DeepWalk embedding of %s network", file)
    start_time = time.time()
    model = DeepWalk(walk_length=100, dimensions=dim, window_size=10)
    model.fit(G)
    embedding = model.get_embedding()
    print("------- %s seconds ---------" % (time.time() - start_time))
    return G, embedding

# ---------------------------------------------------------------
#
# Computing euclidean distance between all embedded nodes
# @param: embedding - embedding of nodes
# @return: distances - structure containing the euclidean
#                      distances between each pair of embedded
#                      nodes
# ---------------------------------------------------------------
def precomputing_euclidean(embedding):
    start = time.time()
    distances = dict()
    for i in range(len(embedding)):
        for j in range(len(embedding)):
            alias = (i,j)
            distances[alias] = -np.linalg.norm(embedding[i]-embedding[j])
    logger.info("Precomputing euclidean distances between node embeddings in %s seconds" % (time.time()-start))
    return distances

# ---------------------------------------------------------------
#
# Compute the core number (the largest value k of a k-core
# containing that node) of each node.
# @param: G - NetworkX graph
# @return: k_core - dictionary keyed by node which values are the
#                   core numbers
# ---------------------------------------------------------------
def compute_k_core_values(G):
    start_time = time.time()
    k_core = nx.core_number(G)
    logger.info("Computed K-Core values in %s seconds" % (time.time() - start_time))
    return k_core

# ---------------------------------------------------------------
#
# An other method to compute k_shell values.
# ---------------------------------------------------------------

def check(h, d):
    f = 0
    for i in h.nodes():
        if (h.degree(i) <= d):
            f = 1
            break
    return f


def find_nodes(h, it):
    s = []
    for i in h.nodes():
        if (h.degree(i) <= it):
            s.append(i)
    return s


def kShell_values(h):
    start = time.time()
    it = 1
    tmp = []
    buckets = []

    while (1):
        flag = check(h, it)
        if (flag == 0):
            it += 1
            buckets.append(tmp)
            tmp = []
        if (flag == 1):
            node_set = find_nodes(h, it)
            for each in node_set:
                h.remove_node(each)
                tmp.append(each)
        if (h.number_of_nodes() == 0):
            buckets.append(tmp)
            break

    core_values = dict()

    value = 1

    for b in buckets:
        for n in b:
            core_values[n] = value
        value += 1
    logger.info(("kShell in %s seconds") % (time.time()-start))
    return core_values


def asp_s(H, G):
    n = H.number_of_nodes()
    asp_value = 0
    if not (nx.is_connected(H)):
        diameter = nx.diameter(G)
    for i in H:
        for j in H:
            if nx.has_path(H, source=i, target=j):
                asp_value += nx.shortest_path_length(H, source=i, target=j)
            else:
                asp_value += diameter
    asp_value = asp_value / (n * (n-1))
    return asp_value

# ---------------------------------------------------------------
#
# Algorithms for finding ASP for a graph H
# @param: H - graph
# @return: asp_value - average shortest path of graph H
# ---------------------------------------------------------------

def asp(H):
    n = H.number_of_nodes()
    asp_value = 0
    if not (nx.is_connected(H)):
        diameter = nx.diameter(H)
    for i in H:
        for j in H:
            if nx.has_path(H, source=i, target=j):
                asp_value += nx.shortest_path_length(H, source=i, target=j)
            else:
                asp_value += diameter
    asp_value = asp_value / (n * (n-1))
    return asp_value

# ---------------------------------------------------------------
#
# LRASP (Local Relative change of Average Shortest Path
# Centrality) algorithm to obtain the k nodes with higher
# LRASP measures.
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def local_rasp(args):
    G = load_default_graph(args.input)
    lrasp = dict.fromkeys(list(G.nodes), 0)
    for i in G:
        neighbors = neighborhood_including_node(G, i, level=2)
        H = G.subgraph(neighbors.keys())
        if H is not None:
            H_i = H.copy()
            H_i.remove_node(i)
            if H_i is not None:
                asp_value_H = asp(H)
                lrasp[i] = abs(asp_s(H_i, H) - asp_value_H) / asp_value_H
    lrasp = dict(sorted(lrasp.items(), key=operator.itemgetter(1), reverse=True))
    print(lrasp)
    k = args.top
    return list(lrasp.keys())[:k]


# ---------------------------------------------------------------
#
# NLC index algorithm to obtain the influence of nodes
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def nlc(args):
    G, deepwalk_graph = deepwalk_embedding(args.input)
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    core_values = compute_k_core_values(G)
    nlc_indexes = dict.fromkeys(core_values.keys(), 0)
    for i in G:
        neighbors = neighborhood(G, i, level=3)
        for j in neighbors:
            nlc_indexes[i] += (core_values[i] * math.exp(- np.linalg.norm(deepwalk_graph[i] - deepwalk_graph[j])))
    # sorting in descending order the nodes based on their NLC index  values
    nlc_indexes = dict(sorted(nlc_indexes.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(nlc_indexes.keys())[:k]


# ---------------------------------------------------------------
#
# NLC index algorithm to obtain the influence of nodes
# but with NetMF embedding
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def nlc2(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Precomputing euclidean distances between nodes in embedding
    distances = precomputing_euclidean(embedding)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    nlc_indexes = dict.fromkeys(core_values.keys(), 0)
    for i in G:
        neighbors = neighborhood(G, i, level=3)
        for j in neighbors:
            nlc_indexes[i] += (core_values[i] * math.exp(distances[i,j]))
    # sorting in descending order the nodes based on their NLC index  values
    nlc_indexes = dict(sorted(nlc_indexes.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(nlc_indexes.keys())[:k]


# ---------------------------------------------------------------
#
# NLC modified second algorithm to obtain the influence of nodes,
# considering the degrees of nodes.
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def nlc_modified_second(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Precomputing euclidean distances between nodes in embedding
    distances = precomputing_euclidean(embedding)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    # Computing degree for each node
    start_time4 = time.time()
    degrees = {node: val for (node, val) in G.degree()}
    logger.info("Computing degree of each node in %s seconds" % (time.time() - start_time4))
    # Computing the NLC index of each node
    nlc_indexes = dict.fromkeys(core_values.keys(), 0)
    logger.info("Computing NLC index of each node")
    for i in G:
        neighbors = neighborhood(G, i, level=3)
        for j in neighbors:
            nlc_indexes[i] += (core_values[i] * math.exp(distances[i,j]))
    # returning top 10 influential nodes
    result = dict.fromkeys(nlc_indexes.keys(), 0)
    for node in result:
        result[node] = nlc_indexes[node] * degrees[node]
    result = dict(sorted(result.items(), key=operator.itemgetter(1), reverse=False))
    k = args.top
    return list(result.keys())[:k]


# ---------------------------------------------------------------
#
# NLC modified third algorithm to obtain the influence of nodes,
# considering the ratio between the node's degree and the total
# degree of neighborhood of each node.
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def nlc_modified_third(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Precomputing euclidean distances between nodes in embedding
    distances = precomputing_euclidean(embedding)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    # Computing degree for each node
    start_time4 = time.time()
    degrees = {node: val for (node, val) in G.degree()}
    logger.info("Computing degree of each node in %s seconds" % (time.time() - start_time4))
    # Computing the NLC index of each node
    nlc_indexes = dict.fromkeys(core_values.keys(), 0)
    neighborhood_degree = dict.copy(nlc_indexes)
    influence = dict.copy(nlc_indexes)
    logger.info("Computing NLC index and degree ratio of each node")
    for i in G:
        neighbors = neighborhood(G, i, level=3)
        neighborhood_degree[i] += degrees[i]
        for j in neighbors:
            nlc_indexes[i] += (core_values[i] * math.exp(distances[i, j]))
            neighborhood_degree[i] += degrees[j]
        influence[i] = degrees[i] / neighborhood_degree[i]
    # returning top 10 influential nodes
    result = dict.fromkeys(nlc_indexes.keys(), 0)
    for node in result:
        result[node] = nlc_indexes[node] * influence[node]
    result = dict(sorted(result.items(), key=operator.itemgetter(1), reverse=False))
    k = args.top
    return list(result.keys())[:k]


def nlc_triangle(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Precomputing euclidean distances between nodes in embedding
    distances = precomputing_euclidean(embedding)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    triangles_pernode = dict.fromkeys(core_values.keys(), 0)
    nlc_indexes = dict.fromkeys(core_values.keys(), 0)
    for i in G:
        neighbors = neighborhood_including_node(G, i, level=3)
        triangles_pernode[i] += sum(nx.triangles(nx.subgraph(G, neighbors))) / 3
        del neighbors[i]
        for j in neighbors:
            nlc_indexes[i] += (core_values[i] * triangles_pernode[i] * math.exp(distances[i, j]))
    # sorting in descending order the nodes based on their NLC index  values
    nlc_indexes = dict(sorted(nlc_indexes.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(nlc_indexes.keys())[:k]


def nlc_ksd(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    average_core_number = statistics.mean(list(core_values.values()))
    # Computing degree for each node
    degrees = {node: val for (node, val) in G.degree()}
    average_degree = statistics.mean(list(degrees.values()))

    ratio = average_core_number / average_degree

    distances = dict()
    nlc_indexes = dict.fromkeys(core_values.keys(), 0)
    for i in G:
        neighbors = neighborhood(G, i, level=3)
        for j in neighbors:
            alias = (i, j)
            distances[alias] = -np.linalg.norm(embedding[i] - embedding[j])
            nlc_indexes[i] += ((core_values[i] + core_values[j]) + ratio * (degrees[i] + degrees[j])) * math.exp(distances[i, j])
    # sorting in descending order the nodes based on their NLC index  values
    nlc_indexes = dict(sorted(nlc_indexes.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(nlc_indexes.keys())[:k]


def bf_num_spaths(G):
    n_spaths = dict.fromkeys(G, 0.0)
    for source in G:
        for target in G:
            if source == target:
                continue
            for path in nx.all_shortest_paths(G, source, target):
                for node in path[1:]: # ignore firs element (source == node)
                    n_spaths[node] += 1 # this path passes through `node`
    return n_spaths


def nlc_shks(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Precomputing euclidean distances between nodes in embedding
    distances = precomputing_euclidean(embedding)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    # Computing degree for each node
    degrees = {node: val for (node, val) in G.degree()}
    # Computing average node stress
    S = statistics.mean(list(bf_num_spaths(G).values()))
    alfa = 0.0000154 * S + 22.34
    c = dict.fromkeys(core_values.keys(), 0)
    sh = dict.fromkeys(core_values.keys(), 0)
    I = dict.fromkeys(core_values.keys(), 0)
    C = dict.fromkeys(core_values.keys(), 0)
    IS = dict.fromkeys(core_values.keys(), 0)
    SHKS = dict.fromkeys(core_values.keys(), 0)
    for v in G:
        neighbors = neighborhood(G, v, level=1)
        for u in neighbors:
            pvu = 1 / (len(neighbors.keys()) )
            neighbors2 = neighborhood(G, u, level=1)
            intersection = {i: neighbors[i] for i in set(neighbors.keys()).intersection(set(neighbors2.keys()))}
            second_factor = 0
            for w in intersection:
                neighbors3 = neighborhood(G, w, level=1)
                pvw = 1 / (len(neighbors.keys()))
                pwu = 1 / (len(neighbors3.keys()))
                second_factor += pvw * pwu
            term = math.pow(pvu + second_factor, 2)
            c[v] += term
        sh[v] = 1 / c[v] #sh
        I[v] = alfa * sh[v] + core_values[v]

    for v in G:
        neighbors = neighborhood(G, v, level=1)
        for u in neighbors:
            C[v] += (I[v] + I[u])

    for v in G:
        neighbors = neighborhood(G, v, level=1)
        for u in neighbors:
            IS[v] += C[u]

    for v in G:
        neighbors = neighborhood(G, v, level=1)
        for u in neighbors:
            SHKS[v] += IS[u] * math.exp(distances[v,u])

    # sorting in descending order the nodes based on their NLC index  values
    SHKS = dict(sorted(SHKS.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(SHKS.keys())[:k]


# ---------------------------------------------------------------
#
# KDEC algorithm to obtain the k top nodes in the
# ranking obtained.
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def kdec(args):
    G = load_graph(args.input)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    # Computing degrees
    degrees = {node: deg for (node, deg) in G.degree()}
    # Computing weights
    weights = {key: core_values[key] * degrees[key] for key in core_values}
    # KDEC structure
    kdec = dict.fromkeys(core_values.keys(), 0.0);
    for i in G:
        neighbors = neighborhood(G, i, level=1)
        for j in neighbors:
            eff_ij = (1 - math.log(1 / degrees[j]))
            kdec[i] += ((weights[i] * weights[j]) / (math.pow(eff_ij, 2)))
    # sorting in descending order the nodes based on their values
    kdec = dict(sorted(kdec.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(kdec.keys())[:k]

# ---------------------------------------------------------------
#
# KDEC algorithm version which considers the embedding nodes too.
# @param: args - arguments from command line
# Prints the top K influential nodes in the graph
# ---------------------------------------------------------------
def nlc_kdec(args):
    G = load_graph(args.input)
    # Using NetMF embedding from karateclub module
    logger.info("NetMF embedding of network in %s dataset", args.input)
    start_time1 = time.time()
    model = ne.NetMF()
    model.fit(G)
    embedding = model.get_embedding()
    logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
    G.remove_edges_from(list(nx.selfloop_edges(G)))
    # Precomputing euclidean distances between nodes in embedding
    distances = precomputing_euclidean(embedding)
    # Computing k-core value of each node
    core_values = compute_k_core_values(G)
    # Computing degrees
    degrees = {node: deg for (node, deg) in G.degree()}
    # Computing weights
    weights = {key: core_values[key] * degrees[key] for key in core_values}
    # print(weights)
    # KDEC structure
    nlckdec = dict.fromkeys(core_values.keys(), 0.0)
    for i in G:
        neighbors = neighborhood(G, i, level=1)
        for j in neighbors:
            eff_ij = (1 - math.log(1 / degrees[j]))
            nlckdec[i] += ((weights[i] * weights[j]) / (math.pow(eff_ij, 2))) * math.exp(distances[i,j])

    # sorting in descending order the nodes based on their values
    nlckdec = dict(sorted(nlckdec.items(), key=operator.itemgetter(1), reverse=True))
    # returning top 10 influential nodes
    k = args.top
    return list(nlckdec.keys())[:k]


# def gravity_model_modified(args):
#     G = load_graph(args.input)
#     nodes = G.number_of_nodes()
#     # Using NetMF embedding from karateclub module
#     logger.info("NetMF embedding of network in %s dataset", args.input)
#     start_time1 = time.time()
#     model = ne.NetMF()
#     model.fit(G)
#     embedding = model.get_embedding()
#     logger.info("NetMF embedding in %s seconds" % (time.time() - start_time1))
#     G.remove_edges_from(list(nx.selfloop_edges(G)))
#     # Precomputing euclidean distances between nodes in embedding
#     distances = precomputing_euclidean(embedding)
#     # Computing the degree of each node
#     degrees = {node: val for (node, val) in G.degree()}
#     # Computing k-core value of each node
#     core_values = compute_k_core_values(G)
#     ks_max = max(core_values.values())
#     ks_min = min(core_values.values())
#     attraction_coefficient = dict()
#     force_node = dict()
#     # K-SHell based on gravity centrality with NetMF embedding for distances
#     KSGCNetMF = dict.fromkeys(core_values.keys(), 0)
#     for i in G:
#         neighbors = neighborhood(G, i, level=3) # Computing 3rd-order neighborhood of node i
#         for j in neighbors:
#             alias = (i, j)
#             attraction_coefficient[alias] = math.exp((core_values[i] - core_values[j]) / (ks_max - ks_min))
#             force_node[alias] = attraction_coefficient[alias] * ((degrees[i] * degrees[j]) / distances[alias])
#             KSGCNetMF[i] += force_node[alias]
#     # sorting in descending order
#     nlc_indexes = dict(sorted(KSGCNetMF.items(), key=operator.itemgetter(1), reverse=True))
#     # returning top 10 influential nodes
#     k = args.top
#     print(list(KSGCNetMF.keys())[:k])

def switch(file):
    match file:
        case "adjnoun.gml":
            return adjnoun_top
        case "dolphins.gml":
            return dolphins_top
        case "lesmis.gml":
            return lesmis_top
        case "polbooks.gml":
            return polbooks_top
        case "power.gml":
            return power_top
        case "blogcatalog.mat":
            return blogcatalog_top
        case "PPI.mat":
            return PPI_top
        case "wikipedia.mat":
            return wikipedia_top
        case "ego_facebook.txt":
            return egofacebook_top
        case "Yeast.txt":
            return yeast_top


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--input", type=str, required=True,
                        help=".mat input file path of original network")
    parser.add_argument("--top", default=10, type=int,
                        help="#nodes top nodes")
    parser.add_argument('--nlc', dest="nlc", action="store_true",
                        help="using NLC to compute influence of nodes")
    parser.set_defaults(nlc=False)

    args = parser.parse_args()
    logging.basicConfig(level=logging.INFO,
                        format='%(asctime)s %(message)s')  # include timestamp
    G = load_graph(args.input)
    length = G.number_of_nodes()
    nlc_counter = dict.fromkeys(list(G.nodes()), 0)
    nlcksd_counter = dict.fromkeys(list(G.nodes()), 0)
    # Computing more iterations depending on file size
    if ".gml" in args.input:
        for i in range(1000):
            nlc_nodes = nlc(args)
            for j in nlc_nodes:
                nlc_counter[j] += 1
            nlcksd_nodes = nlc_ksd(args)
            for j in nlcksd_nodes:
                nlcksd_counter[j] += 1
    if ".mat" in args.input:
        for i in range(5):
            nlc_nodes = nlc(args)
            for j in nlc_nodes:
                nlc_counter[j] += 1
            nlcksd_nodes = nlc_ksd(args)
            for j in nlcksd_nodes:
                nlcksd_counter[j] += 1
    if ".txt" in args.input:
        for i in range(100):
            nlc_nodes = nlc(args)
            for j in nlc_nodes:
                nlc_counter[j] += 1
            nlcksd_nodes = nlc_ksd(args)
            for j in nlcksd_nodes:
                nlcksd_counter[j] += 1
    nlc_counter = dict(sorted(nlc_counter.items(), key=operator.itemgetter(1), reverse=True))
    nlcksd_counter = dict(sorted(nlcksd_counter.items(), key=operator.itemgetter(1), reverse=True))

    first = (switch(args.input))[:args.top]
    print(first)
    print("NLC")
    top_nlc = list(nlc_counter.keys())[:args.top]
    print(top_nlc)
    count = 0
    for i in top_nlc:
        print(i)
        count += first.count(i)
    print(count)

    print("NLC KSD")
    top_nlcksd = list(nlcksd_counter.keys())[:args.top]
    print(top_nlcksd)
    count = 0
    for i in top_nlcksd:
        print(i)
        count += first.count(i)
    print(count)


